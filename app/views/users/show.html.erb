
<div class="container">
  <div class="mt-4 mb-4">
    <h2> <strong>USER:</strong>  <%= @user.email %>  </h2>
  </div>

  <div>
    <ul id="myTab" class="nav nav-tabs">
      <li class="nav-item">
        <a id="user-info-link" data-toggle="tab" class="nav-link" href="#user">User Info</a>

      </li>
      <li class="nav-item">
        <a id="bookings-link" data-toggle="tab" class="nav-link" href="#bookings">My Bookings</a>
      </li>
      <li class="nav-item">
        <a id="trabis-link" data-toggle="tab" class="nav-link" href="#trabis">My Trabis</a>
      </li>
    </ul>
  </div>
  <div id="user-info-tab" class="bg-white p-4 border">
    <div style="width: 60%" >

      <form id="user-form" action="<%= user_path(@user) %>" method="POST">
        <h5>Personal data</h5>
        <div class="border-top border-dark pt-4 pb-3">
          <input type="hidden" name="_method" value="PUT">
          <div class="d-flex">
            <div class="form-group mr-3">
              <%= cl_image_tag @user.photo, height: 230, width: 230, crop: :fill, gravity: :face, class: "avatar-img"  %>
            </div>
            <div id="files-field"
               class="dropzone dropzone-box dropzone-details">

              <div id="dz-message" class="dz-message">
                Drag your avatar here or click to select file!
              </div>
            </div>
          </div>

        <div class="d-flex">
          <div id="first-name-group" class="trabi-form-group">
            <label for="input-first-name">First name:</label><br>
            <input type="text" class="" id="input-first-name" value="<%= @user.first_name %>">
          </div>
           <div id="last-name-group" class="trabi-form-group">
            <label for="input-last-name">Last name:</label><br>
            <input type="text" class="" id="input-last-name" value="<%= @user.last_name %>">
          </div>
        </div>
        <div class="d-flex">
          <div class="trabi-form-group">
            <label for="input-email">Email address:</label><br>
            <input type="email" class="" id="input-email" value="<%= @user.email %>">
          </div>
           <div class="trabi-form-group">
            <label for="input-phone">Phone number:</label><br>
            <input type="text" class="" id="input-phone" value="<%= @user.phone_number %>">
          </div>
        </div>
      </div>

      <h5>Address</h5>
      <div class="border-top border-bottom border-dark pb-3 mb-4">

        <div class="d-flex">
          <div class="trabi-form-group">
            <label for="input-street">Street:</label><br>
            <input type="text" class="" id="input-street" value="<%= @user.street_address %>">
          </div>
           <div class="trabi-form-group">
            <label for="input-city">City:</label><br>
            <input type="text" class="" id="input-city" value="<%= @user.city_address %>">
          </div>
        </div>
        <div class="d-flex">
          <div class="trabi-form-group">
            <label for="input-zip">ZIP code:</label><br>
            <input type="text" class="" id="input-zip" value="<%= @user.zip_address %>">
          </div>
           <div class="trabi-form-group">
            <label for="input-country">Country:</label><br>
            <input type="text" class="" id="input-country" value="<%= @user.country_address %>">
          </div>
        </div>

      </div>

      <button type="submit" class="trabi-btn">Submit changes</button>

    </form>

    </div>

  </div>

  <div id="bookings-tab" class="bg-white p-4 border">
    <h5>Current bookings</h5>
    <% if @current_bookings == [] %>
      <div class="mt-3 mb-5">
        <em>No current bookings</em>
      </div>
    <% else %>

      <table class="table">
        <thead>
          <tr>
            <th scope="col" class="th-lg">Booking #</th>
            <th scope="col" class="th-lg">Start date</th>
            <th scope="col" class="th-lg">End date</th>
            <th scope="col" class="th-lg">Car</th>
            <th scope="col" class="th-lg">Owner</th>
            <th scope="col" class="th-lg"></th>
          </tr>
        </thead>
        <tbody>
          <% @current_bookings.each do |booking| %>
          <tr>
            <div class="table-card">
              <div>
                <%= booking.id %>
              </div>
              <div>
                <span>Start date: <%= booking.start_date.strftime("%F %T") %></span>
                <span>End date:
                  <% if DateTime.now <= booking.end_date.to_datetime %>
                    <em>Still running</em>
                  <% else %>
                    <%= booking.end_date.strftime("%F %T") %>
                  <% end %>
                  </span>
              </div>
              <div>
                <span>Car: <%= booking.trabi.title %></span>
                <span>Owner: <%= booking.trabi.user.email %></span>
              </div>
              <div>
                <% if DateTime.now <= booking.end_date.to_datetime %>
                    <a class="trabi-btn disabled">Review</a>
                  <% else %>
                    <a id="<%="#{booking.id}-booking-review-button"%>" class="trabi-btn">Review</a>
                  <% end %>
              </div>
            </div>

          </tr>
            <% if DateTime.now > booking.end_date.to_datetime %>
                <tr>
                  <td colspan="6" class="p-0">
                    <div id="<%="#{booking.id}-booking-review-box"%>" class="border border-dark p-3  row">
                      <div class="col-12">
                        <%= simple_form_for(booking, method: "put") do |f| %>
                        <div class="col-2">
                          <%= f.input :rating_review,  collection: [0, 1, 2, 3, 4, 5], class: "form-group" %>
                        </div>
                        <div class="col-12">
                          <%= f.input :content_review, class: "form-group" %>
                          <%= f.button :submit, label: "Submit review", class: "btn btn-primary" %>
                          <a id="<%="#{booking.id}-booking-review-cl-button"%>" class="btn btn-primary">Close</a>
                        </div>
                        <% end %>
                      </div>
                    </div>
                  </td>
                </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>

    <% end %>

    <h5 class="pt-4">Archived bookings</h5>
    <% if @archived_bookings == [] %>
      <div class="mt-3 mb-5">
        <em>No archived bookings</em>
      </div>
    <% else %>

      <table class="table">
      <thead>
        <tr>
          <th scope="col" class="th-lg">Booking #</th>
          <th scope="col" class="th-lg">Start date</th>
          <th scope="col" class="th-lg">End date</th>
          <th scope="col" class="th-lg">Car</th>
          <th scope="col" class="th-lg">Owner</th>
          <th scope="col" class="th-lg">Rating</th>
        </tr>
      </thead>
      <tbody>
        <% @archived_bookings.each do |booking| %>
        <tr>
          <th scope="row"><%= booking.id %></th>
          <td><%= booking.start_date.strftime("%F %T") %></td>
          <td><%= booking.end_date.strftime("%F %T") %></td>
          <td><%= booking.trabi.title %></td>
          <td><%= booking.trabi.user.email %></td>
          <% if booking.rating_review.nil? %>
            <td><em>No rating</em></td>
          <% else %>
            <td>
              <% if booking.rating_review.zero? %>
                <a id="<%="#{booking.id}-booking-rating-button"%>" class="trabi-icon-btn">
                  <i id="<%="#{booking.id}-bones-icon"%>" class="fas fa-skull-crossbones trabi-icon-skull"></i>
                </a>
              <% else %>
                <a id="<%="#{booking.id}-booking-rating-button"%>" class="trabi-icon-btn">
                  <% booking.rating_review.times do %>
                    <i id="<%="#{booking.id}-star-icon"%>" class="fas fa-star trabi-icon-star"></i>
                  <% end %>
                </a>
              <% end %>
            </td>
          <% end %>
        </tr>
        <tr>
          <td colspan="6" class="p-0">
            <div id="<%="#{booking.id}-booking-rating-box"%>" class="border border-dark p-3  row">
              <div class="col-12">
                <p><%= booking.content_review %></p>
                <a id="<%="#{booking.id}-booking-rating-cl-button"%>" class="btn btn-primary">Close</a>
              </div>


            </div>
          </td>
        </tr>
        <% end %>
      </tbody>
    </table>

  <% end %>

  </div>
  <div id="trabis-tab" class="bg-white p-4 border">
    <h5>My current cars</h5>
    <% if @user.trabis == [] %>
      <div class="mt-3 mb-5">
        <em>No trabis offered yet</em>
      </div>
    <% else %>

      <table class="table">
        <thead>
          <tr>
            <th scope="col" class="th-lg">Trabi #</th>
            <th scope="col" class="th-lg">Title</th>
            <th scope="col" class="th-lg">Color</th>
            <th scope="col" class="th-lg">Year</th>
            <th scope="col" class="th-lg"></th>
          </tr>
        </thead>
        <tbody>
          <% @user.trabis.each do |trabi| %>
          <tr>
            <th scope="row"><%= trabi.id %></th>
            <td class="align-middle"><%= trabi.title %></td>
            <td class="align-middle"><%= trabi.color %></td>
            <td class="align-middle"><%= trabi.year %></td>
            <td class="pt-1 pb-1"><%= link_to "Details", trabi_path(trabi), class: "btn btn-primary" %>
            <!-- <a href="#" class="btn btn-primary">Details</a> --></td>
          </tr>
          <% end %>
        </tbody>
      </table>

    <% end %>
  </div>
</div>
